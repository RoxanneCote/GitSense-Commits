# Activity Summary for 12/3/2025

## 6:38:56 AM
`c:\calogy_ws\HIL_Tester\tests\hil_tests\test_bmu_control.py` (Timestamp: 12/2/2025, 11:21:55 AM) outlines Pytest tests for a Battery Management Unit (BMU) control system. The file establishes various test thresholds and requirements in constants (e.g., `BATTERY_CURRENT_MAX`, `GLOBAL_STATE_REQUIREMENTS`), defining acceptable ranges and states for BMU parameters. It includes comprehensive tests for:
*   **Battery Voltage:** Checks if readings are within 40.0-60.0V.
*   **Load Voltage:** Tests availability and range (0.0-60.0V), including a specific test case to demonstrate a failure scenario.
*   **Coin Cell Presence:** Verifies that the BMU's Real-Time Clock (RTC) retains time after a 12V power cycle, indicating a functioning coin cell.
*   **BMU Temperatures:** Validates individual BMU sensor temperatures against a 15.0-32.0°C range, explicitly handling `-50.0°C` as a "sensor not placed" condition with a warning.
*   **Contactor Control:** Tests the ability to open and close BMU contactors, verifying the state changes.
The tests consistently use helper functions like `print_test` for standardized output formatting and assertions for validation, providing detailed output examples in their docstrings.

`c:\calogy_ws\HIL_Tester\tests\hil_tests\CAHIER_CHARGE_ISOLATION.md` (Timestamp: 12/2/2025, 12:22:19 PM) is a Markdown document detailing the functional, hardware, and methodological requirements for an **Isolation Resistance Variation Test Bench**. Its purpose is to simulate isolation faults on a BMU to verify its ability to measure `Rn` (negative pole to chassis) and `Rp` (positive pole to chassis) and detect isolation states (OK, Warning, Fault). Key points include:
*   Defining conditions for "Isolation OK" (resistance > nominal), "Warning" (< 500 Ω/V), and "Fault" (< 100 Ω/V).
*   Proposing an external circuit with switchable resistors (1 kΩ to 100 kΩ) to simulate different resistance values between battery poles and chassis.
*   Specifying target resistance values for simulation (e.g., 47 kΩ for OK, 4.7 kΩ for Fault) and electrical requirements such as supporting max battery voltage and operating in a floating IT reference.

`c:\calogy_ws\HIL_Tester\tools\can\set_default_cyclic_msgs.mcr` (Timestamp: 12/2/2025, 2:15:38 PM) is a PCAN-Explorer Macro File. It configures the default cyclic CAN messages for a `PROPA2_bms_config` system. The macro first enters configuration mode and then sequentially sends commands to set the transmission periods for various BMU-related messages. These messages include "Fault flags," "bmu_build_info," "gpio_state," "Config elec," "Bat limits," "SOC/SOH/Cap," "bmu_power," "energy_counters," different temperature readings (min/max/avg and all sensors), "bmu_time," "cmu_volt_min_max_avg," "cmu_temp_min_max_avg," "cmu_temp_all," "cmu_heaters_status," "current_raw," "soc_raw," and "clock_info." Transmission periods range from 100ms to 10000ms, with a consistent `Wait 100` delay between most commands.

`c:\calogy_ws\HIL_Tester\src\scripts\hardware\bmu\bmu_control.py` (Timestamp: 12/2/2025, 2:15:49 PM) defines the `BMUControl` Python class, which serves as the core CAN communication and DBC decoding interface for the BMU test bench. It uses `python-can` and `cantools` libraries. Key features include:
*   Initialization of the CAN bus and loading of a DBC file for message definitions.
*   A background receiver thread (`_rx_loop`) that continuously receives, decodes, and caches the latest CAN messages using a threading lock for thread-safety.
*   Methods to `read_message` and `read_mux_message` from the cache, with options for timeout and freshness.
*   Functions to `send_message` and `receive_message` over CAN.
*   A `send_periodic` method to automatically transmit messages at a given interval.
*   High-level control functions `open_contactor` and `close_contactor`, which send periodic `PROPA_bms_ctrl` messages with specific commands and can optionally verify the contactor's state.
The class is designed for robust and asynchronous interaction with the BMU, handling unknown message IDs and decoding errors.

A recurring pattern across these files is the strong focus on **Hardware-in-the-Loop (HIL) testing for a Battery Management Unit (BMU)**, with **CAN communication** and **DBC message definitions** being central to the system's operation. The timestamps, all from December 2, 2025, indicate focused development activities or a snapshot of a particular stage.